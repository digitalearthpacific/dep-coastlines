kind: Workflow
metadata:
  name: tides
  namespace: argo
spec:
  entrypoint: workflow-entrypoint
  serviceAccountName: public-bucket-writer
  podGC:
    strategy: OnWorkflowSuccess
    deleteDelayDuration: 600s
  tolerations:
  - key: digitalearthpacific.org/node-purpose
    operator: Equal
    value: argo
    effect: NoSchedule
  - key: kubernetes.azure.com/scalesetpriority
    operator: Equal
    value: spot
    effect: NoSchedule
  arguments:
    parameters:
    - name: image-tag
      value: "v0.8.0dev28"
  workflowMetadata:
    labels:
      app: dep_ls_coastlines
  templates:
  - name: workflow-entrypoint
    container:
      image: "ghcr.io/digitalearthpacific/dep-coastlines:{{ workflow.parameters.image-tag }}"
      imagePullPolicy: IfNotPresent
      resources:
        requests: 
          memory: 32Gi
          cpu: 4
      command: [ python ]
      args:
        - dep_coastlines/calculate_tides.py
